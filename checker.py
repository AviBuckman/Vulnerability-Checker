import glob, os, sys, subprocess, csv

def check_file(path):
    temp_path = "/home/avi/Desktop/Vulnerability_Checker/temp.txt"
    obj_command = ' objdump -D ' + path +' > '+ temp_path
    subprocess.call(obj_command,shell=True)
    found_words = find_words_in_file(temp_path)
    if len(found_words)>0:
        file_dict[path] = found_words

def find_words_in_file(path):
    dump = open(path)
    found = set()
    for line in dump:
        for func_word in func_list:
            if (func_word in line):
                found.add(func_word)
    return found

def load_functions():
    

vulnerable_function_path = "vulnerable_functions.csv"

root_directory_path = sys.argv[1]
os.chdir(root_directory_path)
file_path_list = glob.glob(root_directory_path+"/**/*.so",recursive=True)
func_list = load_functions()
file_dict = {}
for file in file_path_list:
    check_file(file)

print(file_dict)


    