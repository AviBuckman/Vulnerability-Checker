from CSV_handler import CSVHandler, DataHandler
from checker import Checker
import csv

libsrpm = ['dbus-tools-1.12.8-9.el8.x86_64']
libsdpkg = [
    {'name': 'accountsservice', 'version': '0.6.45-1ubuntu1', 'architecture': 'amd64'}
]


def test():
    data_handler: DataHandler = CSVHandler()
    checker: Checker = Checker(data_handler)

    if checker.PackageOrganized["manager"] == "rpm":
        checker.scan_library_list(libsrpm)
        t1 = open('./resources/realOutputRpm.csv', 'r')
        t3 = open('./resources/realOutputStringsRpm.csv', 'r')
    else:
        checker.scan_library_list(libsdpkg)
        t1 = open('./resources/realOutputUbuntu.csv', 'r')
        t3 = open('./resources/realOutputStringsUbuntu.csv', 'r')

    t2 = open('./resources/vulnerability.csv', 'r')
    t4 = open('./resources/strings.csv', 'r')

    fileone = t1.readlines()
    filetwo = t2.readlines()
    fileone2 = t3.readlines()
    filetwo2 = t4.readlines()
    t1.close()
    t2.close()
    t3.close()
    t4.close()
    vul = equals(fileone, filetwo)
    st = equals(fileone2, filetwo2)
    print(f"vul={vul} and st={st}")
    return vul and st


def equals(fileone, filetwo):
    x = 0
    for i in fileone:
        if i not in filetwo and x != 0:
            return False
        x = x+1
    return True


print(test())

# def test():

#     reader1 = csv.reader("realOutput_vul.csv")
#     reader2 = csv.reader("vulnerability.csv")

#     for lhs, rhs in itertools.izip(reader1, reader2):
#         if lhs != rhs:
#             return False
#     # strings table:
#     reader1 = csv.reader("realOutput_strings")
#     reader2 = csv.reader("strings.csv")

#     for lhs, rhs in itertools.izip(reader1, reader2):
#         if lhs != rhs:
#             return False
#     return True
