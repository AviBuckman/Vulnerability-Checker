# entry fields
PACKAGE_MANAGER = "package_manager"
PACKAGE = "package"
VERSION = "version"
FULL_PATH = "full_path"
DIRECTORY = "directory"
FILE_NAME = "file_name"
FILE_OUTPUT = "file_info_output"
MD5 = "md5"
SHA1 = "sha1"
SHA256 = "sha256"
B2 = "b2"
STRINGS = "strings"
READELF = "readelf"
VULNERABLE_FUNC = "vulnerable_functions"
SECRET_KEYS = "secret_keys"
CHECKSEC = "checksec"

# checker.py
VUL_FUNC_PATH = 'resources/vulnerable_functions.csv'
STRINGS_PATH = 'resources/secretKeys.csv'
C_SUFFIX = "@GLIBC"  # c_suffix differentiates between library func and user-defined func
DPKG_MAP = {"manager": "dpkg", "listOfFiles": "-L",
            "trackPackage": "-S", "version": "-s"}
RPM_MAP = {"manager": "rpm", "listOfFiles": "-ql",
           "trackPackage": "-qf", "version": "-qi"}
# checksecTocsv.py
TITLESOFCHECK = ["RELRO", "Canary", "NX", "PIE", "CFI", "SafeStack",
                 "RPATH", "RUNPATH", "Symbols", "Fortify", 'Fortified', "Fortifiable", "File"]
FILE_NAME = "./resources/Checksec.csv"

# csv_handler.py
VULNERABILITY_FILE_NAME = "./resources/vulnerability.csv"
STRINGS_FILE_NAME = "./resources/strings.csv"
TITLES = ["package", "package_manager", "version", "full_path", "directory", "file_name", "file_info_output",
          "md5", "sha1", "sha256", "b2", "secret_keys", "vulnerable_functions", "checksec"]

# db_handler.py
LINE = "line"
VULNERABILITY_TABLE_NAME = 'vulnerabilities'
STRINGS_TABLE_NAME = 'stringsLines'

DRIVER_STRING = 'ODBC Driver 17 for SQL Server'
SERVER = 'v-eam-server.database.windows.net'
DATABASE = 'Vulnerabilties'
USERNAME = 'namor'
PASSWORD = 'EAM1234!'
CONNECTION_SETTINGS = f'DRIVER={DRIVER_STRING};SERVER={SERVER};DATABASE={DATABASE};UID={USERNAME};PWD={PASSWORD}'
CREATE_QUERY = f"""
        IF NOT EXISTS (SELECT *
            FROM [{DATABASE}].INFORMATION_SCHEMA.TABLES
            WHERE TABLE_NAME = '{VULNERABILITY_TABLE_NAME}')
                BEGIN
                    SET ANSI_NULLS ON
                    SET QUOTED_IDENTIFIER ON
                    CREATE TABLE [dbo].[{VULNERABILITY_TABLE_NAME}](
                        [{PACKAGE}] [varchar](280) NOT NULL,
                        [{PACKAGE_MANAGER}] [varchar](10) NOT NULL,
                        [{VERSION}] [varchar](280) NOT NULL,
                        [{FULL_PATH}] [varchar](280) NOT NULL,
                        [{DIRECTORY}] [varchar](max) NOT NULL,
                        [{FILE_NAME}] [varchar](max) NOT NULL,
                        [{FILE_OUTPUT}] [varchar](8000) NOT NULL,
                        [{MD5}] [varchar](max) NOT NULL,
                        [{SHA1}] [varchar](max) NOT NULL,
                        [{SHA256}] [varchar](max) NOT NULL,
                        [{B2}] [varchar](max) NOT NULL,
                        [{STRINGS}] [varchar](max) NULL,
                        [{SECRET_KEYS}] [varchar](max) NULL,
                        [{READELF}] [varchar](max) NULL,
                        [{VULNERABLE_FUNC}] [varchar](max) NULL,
                        [{CHECKSEC}] [varchar](max) NULL
                    ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
                    SET ANSI_PADDING ON
                    ALTER TABLE [dbo].[{VULNERABILITY_TABLE_NAME}] ADD PRIMARY KEY CLUSTERED
                    (
                        [{PACKAGE}] ASC,
                        [{PACKAGE_MANAGER}] ASC,
                        [{VERSION}] ASC,
                        [{FULL_PATH}] ASC
                    )WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [PRIMARY]

                    SET ANSI_NULLS ON
                    SET QUOTED_IDENTIFIER ON
                    CREATE TABLE [dbo].[{STRINGS_TABLE_NAME}](
                        [id] [uniqueidentifier] NOT NULL,
                        [{PACKAGE}] [varchar](280) NOT NULL,
                        [{PACKAGE_MANAGER}] [varchar](10) NOT NULL,
                        [{VERSION}] [varchar](280) NOT NULL,
                        [{FULL_PATH}] [varchar](280) NOT NULL,
                        [{LINE}] [varchar](max) NOT NULL
                    ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
                    SET ANSI_PADDING ON
                    ALTER TABLE [dbo].[{STRINGS_TABLE_NAME}] ADD PRIMARY KEY CLUSTERED
                    (
                        [id] ASC,
                        [{PACKAGE}] ASC,
                        [{PACKAGE_MANAGER}] ASC,
                        [{VERSION}] ASC,
                        [{FULL_PATH}] ASC
                    )WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [PRIMARY]
                    ALTER TABLE [dbo].[{STRINGS_TABLE_NAME}] ADD  DEFAULT (newid()) FOR [id]
                    ALTER TABLE [dbo].[{STRINGS_TABLE_NAME}]  WITH CHECK ADD FOREIGN KEY([{PACKAGE}], [{PACKAGE_MANAGER}], [{VERSION}], [{FULL_PATH}])
                    REFERENCES [dbo].[{VULNERABILITY_TABLE_NAME}] ([{PACKAGE}], [{PACKAGE_MANAGER}], [{VERSION}], [{FULL_PATH}])
                    ON DELETE CASCADE
                    ON UPDATE CASCADE
                END
                """
